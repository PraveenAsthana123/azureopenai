# Building Blocks Diagram
# Enterprise GenAI Knowledge Copilot Platform

**Document Version:** 1.0
**Date:** November 2024

---

## 1. System Building Blocks Overview

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                         SYSTEM BUILDING BLOCKS                                    │
│                                                                                  │
│  Modular architecture components that make up the GenAI Copilot Platform         │
└──────────────────────────────────────────────────────────────────────────────────┘


                              ┌─────────────────────────────┐
                              │                             │
                              │     USER INTERFACE BLOCK    │
                              │     ═══════════════════     │
                              │                             │
                              │     React SPA Frontend      │
                              │     • Chat Interface        │
                              │     • Search Interface      │
                              │     • Admin Dashboard       │
                              │                             │
                              └──────────────┬──────────────┘
                                             │
                                             │ REST API
                                             ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│                              API LAYER BLOCK                                    │
│                              ═══════════════                                    │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          API GATEWAY                                    │   │
│  │  • Authentication      • Rate Limiting      • Request Validation       │   │
│  │  • Route Handling      • Response Caching   • Error Handling           │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                             │
                    ┌────────────────────────┼────────────────────────┐
                    │                        │                        │
                    ▼                        ▼                        ▼
┌──────────────────────────┐  ┌──────────────────────────┐  ┌──────────────────────────┐
│                          │  │                          │  │                          │
│   ORCHESTRATION BLOCK    │  │    INGESTION BLOCK       │  │   RAG PROCESSING BLOCK   │
│   ═══════════════════    │  │    ═══════════════       │  │   ════════════════════   │
│                          │  │                          │  │                          │
│   • Workflow Management  │  │   • Document Upload      │  │   • Query Embedding      │
│   • Context Assembly     │  │   • File Parsing         │  │   • Hybrid Search        │
│   • Response Aggregation │  │   • OCR Processing       │  │   • Context Building     │
│   • Error Recovery       │  │   • Text Chunking        │  │   • LLM Generation       │
│                          │  │   • Embedding Gen.       │  │   • Response Formatting  │
│                          │  │   • Index Management     │  │   • Citation Extraction  │
└────────────┬─────────────┘  └────────────┬─────────────┘  └────────────┬─────────────┘
             │                             │                             │
             └─────────────────────────────┼─────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│                            AI SERVICES BLOCK                                    │
│                            ═════════════════                                    │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │  AZURE OPENAI   │  │  DOCUMENT       │  │  CONTENT        │                │
│  │                 │  │  INTELLIGENCE   │  │  SAFETY         │                │
│  │  • GPT-4o-mini  │  │                 │  │                 │                │
│  │  • Embeddings   │  │  • OCR          │  │  • Moderation   │                │
│  │                 │  │  • Layout       │  │  • Filtering    │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│                            DATA SERVICES BLOCK                                  │
│                            ═══════════════════                                  │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │  AZURE AI       │  │   COSMOS DB     │  │  BLOB STORAGE   │                │
│  │  SEARCH         │  │                 │  │                 │                │
│  │                 │  │  • Conversations│  │  • Documents    │                │
│  │  • Vector Index │  │  • Metadata     │  │  • Processed    │                │
│  │  • Hybrid Search│  │  • Sessions     │  │  • Embeddings   │                │
│  │  • Semantic     │  │  • Audit Logs   │  │                 │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│                          INFRASTRUCTURE BLOCK                                   │
│                          ═══════════════════                                    │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   NETWORKING    │  │   SECURITY      │  │   MONITORING    │                │
│  │                 │  │                 │  │                 │                │
│  │  • VNet         │  │  • Key Vault    │  │  • App Insights │                │
│  │  • Private Eps  │  │  • Azure AD     │  │  • Log Analytics│                │
│  │  • Bastion      │  │  • RBAC         │  │  • Alerts       │                │
│  │  • NSGs         │  │  • Managed IDs  │  │  • Dashboards   │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Detailed Building Block Breakdown

### 2.1 User Interface Block

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                        USER INTERFACE BUILDING BLOCK                              │
└──────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                             REACT FRONTEND                                       │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          PRESENTATION LAYER                             │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐               │   │
│  │  │   Chat UI     │  │  Search UI    │  │  Admin UI     │               │   │
│  │  │   Component   │  │  Component    │  │  Component    │               │   │
│  │  │               │  │               │  │               │               │   │
│  │  │  • Message    │  │  • Search Bar │  │  • User Mgmt  │               │   │
│  │  │    List       │  │  • Filters    │  │  • Analytics  │               │   │
│  │  │  • Input Box  │  │  • Results    │  │  • Config     │               │   │
│  │  │  • Citations  │  │  • Facets     │  │  • Monitoring │               │   │
│  │  └───────────────┘  └───────────────┘  └───────────────┘               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          STATE MANAGEMENT                               │   │
│  │                                                                         │   │
│  │  ┌───────────────────────────────────────────────────────────────┐     │   │
│  │  │                   REACT CONTEXT PROVIDERS                     │     │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐           │     │   │
│  │  │  │   Auth      │  │   Chat      │  │   Search    │           │     │   │
│  │  │  │   Context   │  │   Context   │  │   Context   │           │     │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘           │     │   │
│  │  └───────────────────────────────────────────────────────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          SERVICE LAYER                                  │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐               │   │
│  │  │   API         │  │   Auth        │  │   Storage     │               │   │
│  │  │   Service     │  │   Service     │  │   Service     │               │   │
│  │  │   (Axios)     │  │   (MSAL)      │  │   (Local)     │               │   │
│  │  └───────────────┘  └───────────────┘  └───────────────┘               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  TECHNOLOGY STACK:                                                              │
│  • React 18.x        • TypeScript 5.x      • Tailwind CSS                      │
│  • Vite 5.x          • React Router        • MSAL.js                           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 API Gateway Block

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                         API GATEWAY BUILDING BLOCK                                │
└──────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                          AZURE FUNCTION APP                                      │
│                          func-api-genai-copilot                                  │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         REQUEST PIPELINE                                │   │
│  │                                                                         │   │
│  │     ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐      │   │
│  │     │  Auth    │───▶│  Rate    │───▶│ Validate │───▶│  Route   │      │   │
│  │     │Middleware│    │ Limiter  │    │ Request  │    │ Handler  │      │   │
│  │     └──────────┘    └──────────┘    └──────────┘    └──────────┘      │   │
│  │                                                                         │   │
│  │     • JWT Validation    • IP-based      • Schema        • /api/chat   │   │
│  │     • Token refresh     • User-based    • Sanitize      • /api/search │   │
│  │     • User context      • 100 req/min   • Size limit    • /api/docs   │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          API ENDPOINTS                                  │   │
│  │                                                                         │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │   │
│  │  │  POST /api/chat                                                  │  │   │
│  │  │  ─────────────────                                               │  │   │
│  │  │  Submit question → Orchestrator → RAG → Response                 │  │   │
│  │  └──────────────────────────────────────────────────────────────────┘  │   │
│  │                                                                         │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │   │
│  │  │  GET /api/search                                                 │  │   │
│  │  │  ────────────────                                                │  │   │
│  │  │  Search query → AI Search → Ranked Results                       │  │   │
│  │  └──────────────────────────────────────────────────────────────────┘  │   │
│  │                                                                         │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │   │
│  │  │  POST /api/documents                                             │  │   │
│  │  │  ─────────────────────                                           │  │   │
│  │  │  Upload file → Blob Storage → Trigger Ingestion                  │  │   │
│  │  └──────────────────────────────────────────────────────────────────┘  │   │
│  │                                                                         │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │   │
│  │  │  GET /api/conversations                                          │  │   │
│  │  │  ─────────────────────────                                       │  │   │
│  │  │  User ID → Cosmos DB → Conversation List                         │  │   │
│  │  └──────────────────────────────────────────────────────────────────┘  │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  DEPLOYMENT:                                                                    │
│  • SKU: Consumption (Y1)    • Runtime: Python 3.11    • Scale: Auto           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 RAG Processing Block

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                       RAG PROCESSING BUILDING BLOCK                               │
└──────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                          AZURE FUNCTION APP                                      │
│                          func-rag-genai-copilot                                  │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                       QUERY PROCESSING                                  │   │
│  │                                                                         │   │
│  │  Input: User Query                                                      │   │
│  │         │                                                               │   │
│  │         ▼                                                               │   │
│  │  ┌─────────────────┐                                                   │   │
│  │  │  Query          │  • Tokenize query                                 │   │
│  │  │  Preprocessor   │  • Extract entities                               │   │
│  │  │                 │  • Determine intent                               │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  │           ▼                                                             │   │
│  │  ┌─────────────────┐                                                   │   │
│  │  │  Embedding      │  • Azure OpenAI                                   │   │
│  │  │  Generator      │  • text-embedding-3-small                         │   │
│  │  │                 │  • 1536 dimensions                                │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  └───────────┼─────────────────────────────────────────────────────────────┘   │
│              │                                                                  │
│  ┌───────────┼─────────────────────────────────────────────────────────────┐   │
│  │           ▼          RETRIEVAL                                          │   │
│  │  ┌─────────────────┐                                                   │   │
│  │  │  Hybrid Search  │  • Vector similarity search                       │   │
│  │  │  Engine         │  • BM25 keyword search                            │   │
│  │  │                 │  • Reciprocal Rank Fusion                         │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  │           ▼                                                             │   │
│  │  ┌─────────────────┐                                                   │   │
│  │  │  Result         │  • Rerank by relevance                            │   │
│  │  │  Ranker         │  • Filter by permissions                          │   │
│  │  │                 │  • Select top-K chunks                            │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  └───────────┼─────────────────────────────────────────────────────────────┘   │
│              │                                                                  │
│  ┌───────────┼─────────────────────────────────────────────────────────────┐   │
│  │           ▼          AUGMENTATION                                       │   │
│  │  ┌─────────────────┐                                                   │   │
│  │  │  Context        │  • Assemble retrieved chunks                      │   │
│  │  │  Builder        │  • Preserve source metadata                       │   │
│  │  │                 │  • Token budget management                        │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  │           ▼                                                             │   │
│  │  ┌─────────────────┐                                                   │   │
│  │  │  Prompt         │  • System instructions                            │   │
│  │  │  Constructor    │  • Context injection                              │   │
│  │  │                 │  • Query formatting                               │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  └───────────┼─────────────────────────────────────────────────────────────┘   │
│              │                                                                  │
│  ┌───────────┼─────────────────────────────────────────────────────────────┐   │
│  │           ▼          GENERATION                                         │   │
│  │  ┌─────────────────┐                                                   │   │
│  │  │  LLM            │  • Azure OpenAI GPT-4o-mini                       │   │
│  │  │  Generator      │  • Temperature: 0.7                               │   │
│  │  │                 │  • Max tokens: 4096                               │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  │           ▼                                                             │   │
│  │  ┌─────────────────┐                                                   │   │
│  │  │  Response       │  • Extract citations                              │   │
│  │  │  Formatter      │  • Validate sources                               │   │
│  │  │                 │  • Format output                                  │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  │           ▼                                                             │   │
│  │  Output: AI Response + Citations                                        │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  DEPLOYMENT:                                                                    │
│  • SKU: Premium (EP1)    • Runtime: Python 3.11    • Always On: Yes           │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 Document Ingestion Block

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                      DOCUMENT INGESTION BUILDING BLOCK                            │
└──────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                          AZURE FUNCTION APP                                      │
│                          func-ingest-genai-copilot                               │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        TRIGGER LAYER                                    │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │              BLOB STORAGE TRIGGER                               │   │   │
│  │  │                                                                 │   │   │
│  │  │  Container: documents                                           │   │   │
│  │  │  Event: BlobCreated                                             │   │   │
│  │  │  Filter: *.pdf, *.docx, *.xlsx, *.pptx, *.txt, *.md            │   │   │
│  │  │                                                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│  ┌───────────────────────────────────┼─────────────────────────────────────┐   │
│  │                        PROCESSING LAYER                                 │   │
│  │                                   │                                     │   │
│  │  ┌─────────────────┐             │                                     │   │
│  │  │  File Type      │◀────────────┘                                     │   │
│  │  │  Detector       │                                                   │   │
│  │  └────────┬────────┘                                                   │   │
│  │           │                                                             │   │
│  │     ┌─────┴─────┬─────────┬─────────┬─────────┐                        │   │
│  │     ▼           ▼         ▼         ▼         ▼                        │   │
│  │  ┌──────┐   ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐                    │   │
│  │  │ PDF  │   │ DOCX │  │ XLSX │  │ PPTX │  │ TXT  │                    │   │
│  │  │Parser│   │Parser│  │Parser│  │Parser│  │Parser│                    │   │
│  │  └──┬───┘   └──┬───┘  └──┬───┘  └──┬───┘  └──┬───┘                    │   │
│  │     │          │         │         │         │                         │   │
│  │     │    ┌─────┴─────────┴─────────┴─────────┴─────┐                   │   │
│  │     │    │                                         │                   │   │
│  │     ▼    ▼                                         │                   │   │
│  │  ┌─────────────────┐                               │                   │   │
│  │  │  Document       │  Azure Cognitive Services     │                   │   │
│  │  │  Intelligence   │  • OCR (scanned pages)        │                   │   │
│  │  │  (OCR)          │  • Layout analysis            │                   │   │
│  │  └────────┬────────┘  • Table extraction           │                   │   │
│  │           │                                         │                   │   │
│  │           └─────────────────────────────────────────┘                   │   │
│  │                       │                                                 │   │
│  │                       ▼                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                    TEXT CHUNKER                                 │   │   │
│  │  │                                                                 │   │   │
│  │  │  Strategy: Semantic Chunking                                    │   │   │
│  │  │  • Chunk size: 512 tokens                                       │   │   │
│  │  │  • Overlap: 50 tokens                                           │   │   │
│  │  │  • Preserve: Paragraphs, sentences                              │   │   │
│  │  │  • Metadata: Page #, section, position                          │   │   │
│  │  │                                                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                       │                                                 │   │
│  │                       ▼                                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                   EMBEDDING GENERATOR                           │   │   │
│  │  │                                                                 │   │   │
│  │  │  Model: Azure OpenAI text-embedding-3-small                     │   │   │
│  │  │  Dimensions: 1536                                               │   │   │
│  │  │  Batch processing: 100 chunks per request                       │   │   │
│  │  │                                                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│  ┌───────────────────────────────────┼─────────────────────────────────────┐   │
│  │                        STORAGE LAYER                                    │   │
│  │                                   │                                     │   │
│  │     ┌─────────────────────────────┴─────────────────────────────┐      │   │
│  │     │                                                           │      │   │
│  │     ▼                                                           ▼      │   │
│  │  ┌─────────────────┐                              ┌─────────────────┐  │   │
│  │  │  Azure AI       │                              │   Cosmos DB     │  │   │
│  │  │  Search Index   │                              │   Metadata      │  │   │
│  │  │                 │                              │                 │  │   │
│  │  │  • Content      │                              │  • Document ID  │  │   │
│  │  │  • Vector       │                              │  • Status       │  │   │
│  │  │  • Metadata     │                              │  • Chunk count  │  │   │
│  │  │                 │                              │  • Permissions  │  │   │
│  │  └─────────────────┘                              └─────────────────┘  │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  DEPLOYMENT:                                                                    │
│  • SKU: Consumption (Y1)    • Runtime: Python 3.11    • Trigger: Blob         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Data Services Block

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                         DATA SERVICES BUILDING BLOCK                              │
└──────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        AZURE AI SEARCH                                  │   │
│  │                        search-genai-copilot                             │   │
│  │                                                                         │   │
│  │  ┌───────────────────────────────────────────────────────────────────┐ │   │
│  │  │  INDEX: genai-copilot-documents                                   │ │   │
│  │  │                                                                   │ │   │
│  │  │  FIELDS:                                                          │ │   │
│  │  │  ┌─────────────────┬──────────────┬─────────────────────────────┐│ │   │
│  │  │  │ Field           │ Type         │ Purpose                     ││ │   │
│  │  │  ├─────────────────┼──────────────┼─────────────────────────────┤│ │   │
│  │  │  │ id              │ Edm.String   │ Unique chunk ID             ││ │   │
│  │  │  │ documentId      │ Edm.String   │ Parent document reference   ││ │   │
│  │  │  │ content         │ Edm.String   │ Chunk text (searchable)     ││ │   │
│  │  │  │ contentVector   │ Coll(Single) │ 1536-dim embedding          ││ │   │
│  │  │  │ title           │ Edm.String   │ Document title              ││ │   │
│  │  │  │ category        │ Edm.String   │ Document category           ││ │   │
│  │  │  │ pageNumber      │ Edm.Int32    │ Source page                 ││ │   │
│  │  │  │ permissions     │ Coll(String) │ Access control              ││ │   │
│  │  │  └─────────────────┴──────────────┴─────────────────────────────┘│ │   │
│  │  │                                                                   │ │   │
│  │  │  FEATURES:                                                        │ │   │
│  │  │  • Vector Search (HNSW algorithm)                                 │ │   │
│  │  │  • Semantic Ranking                                               │ │   │
│  │  │  • Hybrid Search (vector + keyword)                               │ │   │
│  │  │  • Faceted Navigation                                             │ │   │
│  │  │                                                                   │ │   │
│  │  └───────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                         │   │
│  │  SKU: Standard    Replicas: 1    Partitions: 1    ~$250/month          │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          COSMOS DB                                      │   │
│  │                          cosmos-genai-copilot                           │   │
│  │                                                                         │   │
│  │  DATABASE: copilot-db                                                   │   │
│  │                                                                         │   │
│  │  ┌───────────────────┬───────────────────┬───────────────────────────┐ │   │
│  │  │ Container         │ Partition Key     │ Purpose                   │ │   │
│  │  ├───────────────────┼───────────────────┼───────────────────────────┤ │   │
│  │  │ conversations     │ /userId           │ Chat history              │ │   │
│  │  │ documents-meta    │ /category         │ Document metadata         │ │   │
│  │  │ user-sessions     │ /userId           │ User session data         │ │   │
│  │  │ audit-logs        │ /date             │ Audit trail               │ │   │
│  │  │ embeddings-cache  │ /documentId       │ Embedding cache           │ │   │
│  │  └───────────────────┴───────────────────┴───────────────────────────┘ │   │
│  │                                                                         │   │
│  │  SKU: Serverless    Throughput: Auto-scale    ~$25-50/month            │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        BLOB STORAGE                                     │   │
│  │                        stgenaicopilot                                   │   │
│  │                                                                         │   │
│  │  ┌───────────────────┬─────────────────────────────────────────────┐   │   │
│  │  │ Container         │ Purpose                                     │   │   │
│  │  ├───────────────────┼─────────────────────────────────────────────┤   │   │
│  │  │ documents         │ Raw uploaded documents                      │   │   │
│  │  │ processed         │ OCR/extracted content                       │   │   │
│  │  │ embeddings        │ Generated embedding vectors                 │   │   │
│  │  │ cache             │ Temporary processing files                  │   │   │
│  │  │ azure-functions   │ Function app deployment packages            │   │   │
│  │  └───────────────────┴─────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  │  SKU: Standard    Tier: Hot    Redundancy: LRS    ~$10-20/month        │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Security Block

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                          SECURITY BUILDING BLOCK                                  │
└──────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         IDENTITY & ACCESS                               │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                    AZURE AD / ENTRA ID                          │   │   │
│  │  │                                                                 │   │   │
│  │  │  • User authentication (OAuth 2.0 / OIDC)                       │   │   │
│  │  │  • Single Sign-On (SSO)                                         │   │   │
│  │  │  • Multi-Factor Authentication (MFA)                            │   │   │
│  │  │  • Conditional Access policies                                  │   │   │
│  │  │  • App registrations                                            │   │   │
│  │  │                                                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                    MANAGED IDENTITIES                           │   │   │
│  │  │                                                                 │   │   │
│  │  │  Service          │ Identity Type   │ Accesses                  │   │   │
│  │  │  ──────────────────────────────────────────────────────────    │   │   │
│  │  │  Function Apps    │ System-assigned │ Key Vault, Storage,       │   │   │
│  │  │                   │                 │ Cosmos DB, AI Services    │   │   │
│  │  │  VMs              │ System-assigned │ Key Vault, Storage        │   │   │
│  │  │                                                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                        RBAC ROLES                               │   │   │
│  │  │                                                                 │   │   │
│  │  │  Role                    │ Scope            │ Permissions       │   │   │
│  │  │  ───────────────────────────────────────────────────────────   │   │   │
│  │  │  Key Vault Admin         │ Key Vault        │ Full access       │   │   │
│  │  │  Cognitive Services User │ OpenAI, Search   │ Read/Invoke       │   │   │
│  │  │  Storage Blob Data Contr.│ Storage          │ Read/Write blobs  │   │   │
│  │  │  Cosmos DB Account Reader│ Cosmos DB        │ Read/Write data   │   │   │
│  │  │                                                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         SECRETS MANAGEMENT                              │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                      AZURE KEY VAULT                            │   │   │
│  │  │                      kv-genai-copilot                           │   │   │
│  │  │                                                                 │   │   │
│  │  │  SECRETS:                                                       │   │   │
│  │  │  ┌────────────────────────────────────────────────────────────┐│   │   │
│  │  │  │ Secret Name               │ Purpose                        ││   │   │
│  │  │  ├────────────────────────────────────────────────────────────┤│   │   │
│  │  │  │ openai-api-key            │ Azure OpenAI authentication    ││   │   │
│  │  │  │ search-api-key            │ AI Search authentication       ││   │   │
│  │  │  │ cosmos-connection-string  │ Cosmos DB connection           ││   │   │
│  │  │  │ storage-connection-string │ Blob Storage connection        ││   │   │
│  │  │  │ docint-api-key            │ Document Intelligence key      ││   │   │
│  │  │  └────────────────────────────────────────────────────────────┘│   │   │
│  │  │                                                                 │   │   │
│  │  │  ACCESS: Via Managed Identity (no stored credentials)           │   │   │
│  │  │  SOFT DELETE: Enabled (90 days retention)                       │   │   │
│  │  │  PURGE PROTECTION: Enabled                                      │   │   │
│  │  │                                                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                         DATA PROTECTION                                 │   │
│  │                                                                         │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │   │
│  │  │                     ENCRYPTION                                   │  │   │
│  │  │                                                                  │  │   │
│  │  │  AT REST:                                                        │  │   │
│  │  │  • Storage: AES-256 (Microsoft-managed keys)                     │  │   │
│  │  │  • Cosmos DB: AES-256 (Microsoft-managed keys)                   │  │   │
│  │  │  • Key Vault: HSM-backed keys                                    │  │   │
│  │  │                                                                  │  │   │
│  │  │  IN TRANSIT:                                                     │  │   │
│  │  │  • TLS 1.2+ for all connections                                  │  │   │
│  │  │  • HTTPS enforced                                                │  │   │
│  │  │                                                                  │  │   │
│  │  └──────────────────────────────────────────────────────────────────┘  │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Infrastructure Block

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                       INFRASTRUCTURE BUILDING BLOCK                               │
└──────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           NETWORKING                                    │   │
│  │                                                                         │   │
│  │  VIRTUAL NETWORK: vnet-genai-copilot-dev                               │   │
│  │  Address Space: 10.0.0.0/16                                            │   │
│  │                                                                         │   │
│  │  ┌───────────────────────────────────────────────────────────────────┐ │   │
│  │  │ Subnet               │ CIDR          │ Purpose                    │ │   │
│  │  ├───────────────────────────────────────────────────────────────────┤ │   │
│  │  │ snet-private-eps     │ 10.0.1.0/24   │ Private endpoints          │ │   │
│  │  │ snet-functions       │ 10.0.2.0/24   │ Function VNet integration  │ │   │
│  │  │ snet-vm              │ 10.0.3.0/24   │ Virtual machines           │ │   │
│  │  │ AzureBastionSubnet   │ 10.0.254.0/27 │ Azure Bastion              │ │   │
│  │  └───────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                         │   │
│  │  PRIVATE ENDPOINTS:                                                    │   │
│  │  • pe-openai      (10.0.1.4)   → Azure OpenAI                         │   │
│  │  • pe-search      (10.0.1.5)   → Azure AI Search                      │   │
│  │  • pe-cosmos      (10.0.1.6)   → Cosmos DB                            │   │
│  │  • pe-storage     (10.0.1.7)   → Blob Storage                         │   │
│  │  • pe-keyvault    (10.0.1.8)   → Key Vault                            │   │
│  │  • pe-docint      (10.0.1.9)   → Document Intelligence                │   │
│  │                                                                         │   │
│  │  PRIVATE DNS ZONES:                                                    │   │
│  │  • privatelink.openai.azure.com                                        │   │
│  │  • privatelink.search.windows.net                                      │   │
│  │  • privatelink.documents.azure.com                                     │   │
│  │  • privatelink.blob.core.windows.net                                   │   │
│  │  • privatelink.vaultcore.azure.net                                     │   │
│  │  • privatelink.cognitiveservices.azure.com                             │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           COMPUTE                                       │   │
│  │                                                                         │   │
│  │  AZURE BASTION:                                                        │   │
│  │  • bastion-genai-copilot                                               │   │
│  │  • SKU: Basic                                                          │   │
│  │  • Secure VM access (no public IPs)                                    │   │
│  │  • ~$140/month                                                         │   │
│  │                                                                         │   │
│  │  VIRTUAL MACHINE:                                                      │   │
│  │  • vm-backend-1                                                        │   │
│  │  • Size: Standard_D2s_v3 (2 vCPU, 8GB RAM)                            │   │
│  │  • OS: Ubuntu 22.04 LTS                                                │   │
│  │  • Purpose: Frontend hosting, backend processing                       │   │
│  │  • ~$70/month                                                          │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          MONITORING                                     │   │
│  │                                                                         │   │
│  │  LOG ANALYTICS WORKSPACE:                                              │   │
│  │  • log-genai-copilot-dev                                               │   │
│  │  • Retention: 30 days                                                  │   │
│  │  • SKU: Pay-as-you-go                                                  │   │
│  │                                                                         │   │
│  │  APPLICATION INSIGHTS:                                                 │   │
│  │  • appi-genai-copilot-dev                                              │   │
│  │  • Connected to: All Function Apps                                     │   │
│  │  • Sampling: 5 items/second                                            │   │
│  │                                                                         │   │
│  │  AZURE MONITOR:                                                        │   │
│  │  • Metric alerts (CPU, memory, errors)                                 │   │
│  │  • Log alerts (error patterns)                                         │   │
│  │  • Action groups (email, Teams)                                        │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Terraform Module Structure

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                       TERRAFORM MODULE BUILDING BLOCKS                            │
└──────────────────────────────────────────────────────────────────────────────────┘

infrastructure/terraform/
│
├── main.tf                          # Root module - orchestrates all modules
├── variables.tf                     # Input variables
├── outputs.tf                       # Output values
├── terraform.tfvars                 # Variable values
├── backend.tfvars                   # Backend configuration
│
└── modules/
    │
    ├── networking/                  # NETWORKING MODULE
    │   ├── main.tf                  # VNet, Subnets, NSGs, Bastion
    │   ├── private-endpoints.tf     # Private endpoints
    │   ├── dns-zones.tf             # Private DNS zones
    │   ├── variables.tf
    │   └── outputs.tf
    │
    ├── storage/                     # STORAGE MODULE
    │   ├── main.tf                  # Storage accounts
    │   ├── containers.tf            # Blob containers
    │   ├── private-endpoints.tf
    │   ├── variables.tf
    │   └── outputs.tf
    │
    ├── database/                    # DATABASE MODULE
    │   ├── main.tf                  # Cosmos DB account
    │   ├── containers.tf            # SQL containers
    │   ├── private-endpoints.tf
    │   ├── variables.tf
    │   └── outputs.tf
    │
    ├── ai-services/                 # AI SERVICES MODULE
    │   ├── main.tf                  # OpenAI, AI Search
    │   ├── cognitive.tf             # Document Intelligence, etc.
    │   ├── deployments.tf           # Model deployments
    │   ├── private-endpoints.tf
    │   ├── variables.tf
    │   └── outputs.tf
    │
    ├── compute/                     # COMPUTE MODULE
    │   ├── main.tf                  # Function Apps, VMs
    │   ├── functions.tf             # Function App configuration
    │   ├── vm.tf                    # Virtual machines
    │   ├── variables.tf
    │   └── outputs.tf
    │
    └── monitoring/                  # MONITORING MODULE
        ├── main.tf                  # Log Analytics, App Insights
        ├── keyvault.tf              # Key Vault
        ├── alerts.tf                # Alert rules
        ├── variables.tf
        └── outputs.tf


MODULE DEPENDENCY GRAPH:
═══════════════════════

                              ┌──────────────────┐
                              │    MAIN.TF       │
                              │  (Root Module)   │
                              └────────┬─────────┘
                                       │
           ┌───────────────────────────┼───────────────────────────┐
           │                           │                           │
           ▼                           ▼                           ▼
    ┌──────────────┐            ┌──────────────┐            ┌──────────────┐
    │  NETWORKING  │            │  MONITORING  │            │   STORAGE    │
    │              │            │              │            │              │
    │  VNet        │            │  Key Vault   │            │  Blob        │
    │  Subnets     │            │  Log Analytics           │  Containers  │
    │  NSGs        │            │  App Insights│            │              │
    │  Bastion     │            │              │            │              │
    └──────┬───────┘            └──────┬───────┘            └──────┬───────┘
           │                           │                           │
           │ Outputs:                  │ Outputs:                  │ Outputs:
           │ • subnet_ids              │ • key_vault_id            │ • storage_name
           │ • dns_zone_ids            │ • app_insights_key        │ • access_key
           │                           │                           │
           └───────────────────────────┼───────────────────────────┘
                                       │
           ┌───────────────────────────┼───────────────────────────┐
           │                           │                           │
           ▼                           ▼                           ▼
    ┌──────────────┐            ┌──────────────┐            ┌──────────────┐
    │   DATABASE   │            │  AI SERVICES │            │   COMPUTE    │
    │              │            │              │            │              │
    │  Cosmos DB   │            │  OpenAI      │            │  Functions   │
    │  Containers  │            │  AI Search   │            │  VMs         │
    │              │            │  Doc Intel.  │            │              │
    └──────────────┘            └──────────────┘            └──────────────┘
```

---

## 7. Cost Building Blocks

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│                          COST BUILDING BLOCKS                                     │
│                          Development Environment                                  │
└──────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│  FIXED COSTS (Always running)                                                   │
│  ═════════════════════════════                                                  │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                         │   │
│  │  ┌───────────────────────┬──────────────────────┬───────────────────┐  │   │
│  │  │ Service               │ SKU                  │ Est. Monthly Cost │  │   │
│  │  ├───────────────────────┼──────────────────────┼───────────────────┤  │   │
│  │  │ Azure Bastion         │ Basic                │ ~$140             │  │   │
│  │  │ Azure AI Search       │ Standard (S1)        │ ~$250             │  │   │
│  │  │ Virtual Machine       │ D2s_v3               │ ~$70              │  │   │
│  │  │ Key Vault             │ Standard             │ ~$5               │  │   │
│  │  │ Log Analytics         │ Pay-as-you-go        │ ~$10              │  │   │
│  │  ├───────────────────────┼──────────────────────┼───────────────────┤  │   │
│  │  │ SUBTOTAL (FIXED)      │                      │ ~$475             │  │   │
│  │  └───────────────────────┴──────────────────────┴───────────────────┘  │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  VARIABLE COSTS (Usage-based)                                                   │
│  ═════════════════════════════                                                  │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                         │   │
│  │  ┌───────────────────────┬──────────────────────┬───────────────────┐  │   │
│  │  │ Service               │ Pricing Model        │ Est. Monthly Cost │  │   │
│  │  ├───────────────────────┼──────────────────────┼───────────────────┤  │   │
│  │  │ Azure OpenAI          │ $0.50/1M input tokens│ ~$50-200          │  │   │
│  │  │                       │ $1.50/1M output tokens                   │  │   │
│  │  │ Functions (Consump.)  │ $0.20/million exec   │ ~$10-30           │  │   │
│  │  │ Cosmos DB (Serverless)│ $0.25 per 1M RU      │ ~$25-50           │  │   │
│  │  │ Blob Storage          │ $0.02/GB + operations│ ~$5-10            │  │   │
│  │  │ Document Intelligence │ $1.50 per 1000 pages │ ~$10-30           │  │   │
│  │  ├───────────────────────┼──────────────────────┼───────────────────┤  │   │
│  │  │ SUBTOTAL (VARIABLE)   │                      │ ~$100-320         │  │   │
│  │  └───────────────────────┴──────────────────────┴───────────────────┘  │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                                                                         │   │
│  │  TOTAL ESTIMATED MONTHLY COST: $575 - $795                              │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                                                                 │   │   │
│  │  │  COST BREAKDOWN PIE:                                            │   │   │
│  │  │                                                                 │   │   │
│  │  │  ████████████████████░░░░░░░░░░  AI Search      (~35%)         │   │   │
│  │  │  ██████████████░░░░░░░░░░░░░░░░  Bastion        (~20%)         │   │   │
│  │  │  ██████████░░░░░░░░░░░░░░░░░░░░  VM             (~10%)         │   │   │
│  │  │  ████████████░░░░░░░░░░░░░░░░░░  OpenAI         (~15%)         │   │   │
│  │  │  ██████░░░░░░░░░░░░░░░░░░░░░░░░  Other Services (~20%)         │   │   │
│  │  │                                                                 │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

*Document End*
